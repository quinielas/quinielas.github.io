<!DOCTYPE html>
<html lang="es" translate="no">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quinielas Caleb - Quinielas Caleb</title>
    <link rel="icon" type="image/png" href="/CALEB.jpeg">
    <link rel="stylesheet" href="/lib/bootstrap/superhero/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/stylesCaleb.css" />
</head>

<body>
    <main class="container">

        <div class="row justify-content-center">
            <div class="col-lg-7 col-md-12 p-0 logo">
                <div class="text-center text-black" style="background-color: #C99F19;">
                    <h1 class="fs-1 fw-bolder pt-1">QUINIELAS CALEB</h1>
                    <span class="m-0 p-2 fs-4 text-uppercase">FIN DE SEMANA</span>
                    <div style="position:absolute; right: 0px; top: 5px;">
                        <img height="70" src="/CALEB.jpeg" />
                    </div>
                </div>
                <table class="table table-sm table-bordered border-gray m-0">
                    <tr class="align-middle">
                        <td id="0_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 0, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/ASTON.png" alt="ASTON.png" />
                            ASTON VILLA
                        </td>
                        <td id="0_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 0, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> FULHAM </span>
                            <img height="17px" src="/flags/FULHAM.png" alt="FULHAM.png" />
                        </td>
                        <td id="0_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 0, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="1_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 1, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/ARSENAL.png" alt="ARSENAL.png" />
                            ARSENAL
                        </td>
                        <td id="1_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 1, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> BOURNEMOUTH </span>
                            <img height="17px" src="/flags/BOURNEMOUTH.png" alt="BOURNEMOUTH.png" />
                        </td>
                        <td id="1_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 1, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="2_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 2, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/CORINTHIANS.png" alt="CORINTHIANS.png" />
                            CORINTHIANS
                        </td>
                        <td id="2_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 2, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> INTERNACIONAL </span>
                            <img height="17px" src="/flags/INTERNACIONAL.png" alt="INTERNACIONAL.png" />
                        </td>
                        <td id="2_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 2, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="3_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 3, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/WEST.png" alt="WEST.png" />
                            WEST HAM
                        </td>
                        <td id="3_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 3, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> TOTTENHAM </span>
                            <img height="17px" src="/flags/TOTTENHAM.png" alt="TOTAL.png" />
                        </td>
                        <td id="3_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 3, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="4_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 4, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/CHELSEA.png" alt="CHELSEA.png" />
                            CHELSEA
                        </td>
                        <td id="4_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 4, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> LIVERPOOL </span>
                            <img height="17px" src="/flags/LIVERPOOL.png" alt="LIVERPOOL.png" />
                        </td>
                        <td id="4_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 4, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="5_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 5, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/ROMA.png" alt="ROMA.png" />
                            ROMA
                        </td>
                        <td id="5_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 5, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> FIORENTINA </span>
                            <img height="17px" src="/flags/FIORENTINA.png" alt="FIORENTINA.png" />
                        </td>
                        <td id="5_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 5, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="6_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 6, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/BOLOGNA.png" alt="BOLOGNA.png" />
                            BOLOGNA
                        </td>
                        <td id="6_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 6, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> JUVENTUS </span>
                            <img height="17px" src="/flags/JUVENTUS.png" alt="JUVENTUS.png" />
                        </td>
                        <td id="6_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 6, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="7_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 7, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/SOCIEDAD.png" alt="SOCIEDAD.png" />
                            REAL SOCIEDAD
                        </td>
                        <td id="7_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 7, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> ATHLETIC </span>
                            <img height="17px" src="/flags/ATHLETIC.png" alt="ATHLETIC.png" />
                        </td>
                        <td id="7_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 7, 'V')">V
                        </td>
                    </tr>
                    <tr class="align-middle">
                        <td id="8_L" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 8, 'L')">L
                        </td>
                        <td class="text-start" style="font-size:0.8rem">
                            <img height="17px" src="/flags/MONTERREY.png" alt="MONTERREY.png" />
                            MONTERREY
                        </td>
                        <td id="8_E" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 8, 'E')">E
                        </td>
                        <td class="text-end" style="font-size:0.8rem">
                            <span class="text-center"> PUMAS </span>
                            <img height="17px" src="/flags/PUMAS.png" alt="PUMAS.png" />
                        </td>
                        <td id="8_V" width="45px" class="text-center fw-bolder" onclick="selectScore(this, 8, 'V')">V
                        </td>
                    </tr>
                </table>
                <div class="text-right fw-bold text-black p-2 text-uppercase" style="background-color: #C99F19;">
                    PRECIO: <span style="color:yellow;">$10.00</span>
                    <span style="float:right;">
                        <span class="text-danger">Cierre: </span>
                        VIERNES 5:00 P.&#xA0;M.</span>
                </div>


                <div class="fs-3 fw-bold text-center text-uppercase">Informes: <span
                        id="numeroTelefono">&#x2B;523344666502</span></div>

                <div class="text-center fw-bold text-white p-2" style="background-color: #C99F19;">
                    <a class="link-light text-decoration-none"
                        href="https://www.facebook.com/profile.php?id=100095112384429" target="_blank"
                        rel="noopener noreferrer">
                        <svg fill="#000000" width="25px" height="25px" viewBox="0 0 29.992 29.808" version="1.1"
                            id="svg6" sodipodi:docname="facebook.svg" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)"
                            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                            xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                            xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                            <defs id="defs10" />
                            <sodipodi:namedview id="namedview8" pagecolor="#ffffff" bordercolor="#000000"
                                borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0"
                                inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" showgrid="false"
                                inkscape:zoom="0.295" inkscape:cx="-271.18644" inkscape:cy="398.30508"
                                inkscape:window-width="1528" inkscape:window-height="1359" inkscape:window-x="632"
                                inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="svg6" />
                            <title id="title2">facebook</title>
                            <g inkscape:groupmode="layer" id="layer1" inkscape:label="Layer 1"
                                transform="translate(-1.004,-1.097)">
                                <ellipse style="fill:#ffffff;stroke-width:0.04" id="path277" cx="15.740767"
                                    cy="16.174273" rx="13.915941" ry="14.587965" />
                            </g>
                            <path
                                d="M 29.992,14.994 C 29.991,6.713 23.278,0 14.996,0 6.714,0 0,6.714 0,14.996 c 0,7.455 5.44,13.639 12.566,14.8 l 0.086,0.012 V 19.33 H 8.844 v -4.336 h 3.808 v -3.302 c -0.019,-0.167 -0.029,-0.361 -0.029,-0.557 0,-2.923 2.37,-5.293 5.293,-5.293 0.141,0 0.281,0.006 0.42,0.016 L 18.318,5.857 c 1.199,0.017 2.359,0.123 3.491,0.312 L 21.675,6.15 V 9.84 H 19.783 C 19.697,9.828 19.598,9.821 19.498,9.821 c -1.197,0 -2.168,0.97 -2.168,2.168 0,0.068 0.003,0.135 0.009,0.202 l -10e-4,-0.009 v 2.812 h 4.159 l -0.665,4.336 h -3.494 v 10.478 c 7.213,-1.174 12.653,-7.359 12.654,-14.814 z"
                                id="path4" style="fill:#0165e1;fill-opacity:1" />
                        </svg>
                        QUINIELAS CALEB
                    </a>
                </div>

            </div>
        </div>

        <div class="text-center fs-3 fw-bolder mb-0">
            TOTAL: $<label id='totalPrice'></label>.00
        </div>

        <div class="row">
            <div>
                <input id="quinielaNombre" class="form-control mb-2" placeholder="NOMBRE DEL PARTICIPANTE" />
            </div>
            <div class="col">
                <div class="d-grid gap-2">
                    <button id="btnClear" class="btn btn-danger">Limpiar</button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2">
                    <button id="btnAdd" class="btn btn-primary">Agregar</button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2">
                    <button id="btnRandom" class="btn btn-secondary">Aleatorio</button>
                </div>
            </div>
            <div class="d-grid gap-2 mt-3">
                <button id="btnSend" class="btn btn-success" onclick="sendAll()">Enviar
                    <svg version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 40 40" xml:space="preserve" width="30"
                        height="30" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                        <defs id="defs108" />
                        <g id="XMLID_468_" transform="matrix(0.12987023,0,0,0.12987013,2.0203061e-4,0)"
                            style="fill:#ffffff">
                            <path id="XMLID_469_"
                                d="m 227.904,176.981 c -0.6,-0.288 -23.054,-11.345 -27.044,-12.781 -1.629,-0.585 -3.374,-1.156 -5.23,-1.156 -3.032,0 -5.579,1.511 -7.563,4.479 -2.243,3.334 -9.033,11.271 -11.131,13.642 -0.274,0.313 -0.648,0.687 -0.872,0.687 -0.201,0 -3.676,-1.431 -4.728,-1.888 -24.087,-10.463 -42.37,-35.624 -44.877,-39.867 -0.358,-0.61 -0.373,-0.887 -0.376,-0.887 0.088,-0.323 0.898,-1.135 1.316,-1.554 1.223,-1.21 2.548,-2.805 3.83,-4.348 0.607,-0.731 1.215,-1.463 1.812,-2.153 1.86,-2.164 2.688,-3.844 3.648,-5.79 l 0.503,-1.011 c 2.344,-4.657 0.342,-8.587 -0.305,-9.856 -0.531,-1.062 -10.012,-23.944 -11.02,-26.348 -2.424,-5.801 -5.627,-8.502 -10.078,-8.502 -0.413,0 0,0 -1.732,0.073 -2.109,0.089 -13.594,1.601 -18.672,4.802 C 90,87.918 80.89,98.74 80.89,117.772 c 0,17.129 10.87,33.302 15.537,39.453 0.116,0.155 0.329,0.47 0.638,0.922 17.873,26.102 40.154,45.446 62.741,54.469 21.745,8.686 32.042,9.69 37.896,9.69 0.001,0 0.001,0 0.001,0 2.46,0 4.429,-0.193 6.166,-0.364 l 1.102,-0.105 c 7.512,-0.666 24.02,-9.22 27.775,-19.655 2.958,-8.219 3.738,-17.199 1.77,-20.458 -1.348,-2.216 -3.671,-3.331 -6.612,-4.743 z"
                                style="fill:#ffffff" />
                            <path id="XMLID_470_"
                                d="M 156.734,0 C 73.318,0 5.454,67.354 5.454,150.143 c 0,26.777 7.166,52.988 20.741,75.928 L 0.212,302.716 c -0.484,1.429 -0.124,3.009 0.933,4.085 C 1.908,307.58 2.943,308 4,308 c 0.405,0 0.813,-0.061 1.211,-0.188 l 79.92,-25.396 c 21.87,11.685 46.588,17.853 71.604,17.853 C 240.143,300.27 308,232.923 308,150.143 308,67.354 240.143,0 156.734,0 Z m 0,268.994 c -23.539,0 -46.338,-6.797 -65.936,-19.657 -0.659,-0.433 -1.424,-0.655 -2.194,-0.655 -0.407,0 -0.815,0.062 -1.212,0.188 L 47.357,261.596 60.281,223.467 C 60.699,222.233 60.49,220.872 59.72,219.82 44.796,199.428 36.907,175.335 36.907,150.143 36.907,84.6 90.661,31.276 156.733,31.276 c 66.064,0 119.812,53.324 119.812,118.867 10e-4,65.535 -53.746,118.851 -119.811,118.851 z"
                                style="fill:#ffffff" />
                        </g>
                    </svg>
                </button>
            </div>
        </div>

        <div class="row justify-content-center mt-3">
            <div class="col-lg-7 col-md-12 text-center" id="score">

            </div>
        </div>
        <div id="pools" class="row justify-content-center mt-3">
        </div>

        <script>
            var unitPrice = 10;
            var currentScore = [[null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null]];
            var gState = {
                quinielaPrincipal: {
                    marcador: [[null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null]],
                    precio: 10,
                },
                usuarioQuinielas: [],
                total: function () {
                    var t = this.usuarioQuinielas.reduce((total, current) => current.precio + total, 0);
                    return t + this.quinielaPrincipal.precio;
                }
            };
            var sellRequest = {
                quinielaId: 45,
                userUrl: '1'
            };

            function sendAll() {
                var quinielaNombre = document.getElementById('quinielaNombre');
                if (quinielaNombre.value === '') {
                    alert('La Quiniela no tiene nombre');
                    quinielaNombre.focus();
                    return;
                }
                var cs = currentScore.map(e => e.filter(x => x !== null).join(''));
                var count = cs.filter(e => e !== '').length;
                var c2 = gState.usuarioQuinielas.length;
                var totalPartidos = currentScore.length;
                if (count == 0) {
                    if (c2 === 0) {
                        alert('Quiniela incompleta');
                        return;
                    }
                } else {
                    if (count < totalPartidos) {
                        alert('Quiniela incompleta');
                        return;
                    }
                }
                var total = document.getElementById('totalPrice').innerText;
                var numeroTelefono = document.getElementById('numeroTelefono').innerText;

                //if (total < 20) {
                  //  alert('El precio minimo total debe ser de $20.00 pesos.');
                    //return;
                //}

                sellRequest.resultados = [];

                var msg = `El total a pagar sera de \$${total}, desea continuar?`;
                if (confirm(msg)) {
                    var marcador = '';
                    if (cs.filter(e => e !== '').length > 0) {
                        marcador = cs.join('%20%20') + '%20%20' + quinielaNombre.value + '%0A';
                        sellRequest.resultados.push({
                            marcador: cs,
                            name: quinielaNombre.value
                        });
                    }
                    for (var i = 0; i < gState.usuarioQuinielas.length; i++) {
                        sellRequest.resultados.push(gState.usuarioQuinielas[i]);
                        marcador += gState.usuarioQuinielas[i].marcador.join('%20%20');
                        var nombre = document.getElementById('pool_' + i).dataset.name;
                        marcador += '%20%20' + nombre;
                        marcador += '%0A';
                    }
                        marcador += "TOTAL A PAGAR $" + total;
                    window.open(`https://wa.me/${numeroTelefono}?text=${marcador}`, '_blank');
                    //fetch('/Sells/save', {
                    //  method: 'POST',
                    //  headers: {
                    //    'Content-Type': 'application/json',
                    //  },
                    //  body: JSON.stringify(sellRequest),
                    //})
                    //.then((res) => {
                    //  window.open(`https://wa.me/${numeroTelefono}?text=${marcador}`,'_blank');
                    //})
                }
            }

            window.addEventListener('load', function () {
                document.getElementById('btnAdd').onclick = addScore;
                document.getElementById('btnClear').onclick = clearScore;
                document.getElementById('btnRandom').onclick = randomScore;
                document.getElementById('totalPrice').innerText = 0;
            });

            function clearScore() {
                currentScore = JSON.parse(JSON.stringify([[null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null], [null, null, null]]));
                var scores = app.els('.selected');
                if (scores.length == 0) {
                    return;
                }
                for (var score of scores) {
                    score.className = 'fw-bolder text-center';
                }
                gState.quinielaPrincipal.precio = 0;
                document.getElementById('totalPrice').innerText = gState.total();
            }

            function randomScore() {
                clearScore();
                var score = ['L', 'E', 'V'];
                for (var i = 0; i < currentScore.length; i++) {
                    var pos = random(0, 3);
                    var id = i + '_' + score[pos];
                    var el = document.getElementById(id);
                    selectScore(el, i, score[pos]);
                }
            }

            function addScore() {
                var count = currentScore.flat().filter(e => e !== null).length;
                if (count < currentScore.length) {
                    alert('Quiniela incompleta');
                    return;
                }
                var quinielaNombre = document.getElementById('quinielaNombre');
                if (quinielaNombre.value === '') {
                    alert('La quiniela no tiene nombre');
                    quinielaNombre.focus();
                    return;
                }
                var marcador = {};
                marcador.precio = gState.quinielaPrincipal.precio;
                marcador.name = quinielaNombre.value;
                gState.quinielaPrincipal.precio = 0;
                var score = [];
                currentScore.forEach(element => {
                    var value = element
                        .filter(e => e !== null)
                        .reduce((prev, current) => prev + current);
                    score.push(value);
                });
                marcador.marcador = score;
                gState.usuarioQuinielas.push(marcador);
                clearScore();
                drawPools('pools', 'marcador', gState.usuarioQuinielas);
            }

            function deletePool(e) {
                var idx = e.target.dataset.idx;
                gState.usuarioQuinielas.splice(idx, 1);
                drawPools('pools', 'marcador', gState.usuarioQuinielas);
                var newPrice = gState.total();
                document.getElementById('totalPrice').innerText = newPrice;
            }

            function selectScore(element, idx, score) {
                var isSelected = element.className === 'selected text-center';
                element.className = isSelected ? 'fw-bolder text-center' : 'selected text-center';
                var matchScore = currentScore[idx];
                var scoreIdx = matchScore.indexOf(score);
                if (scoreIdx != -1 && isSelected) {
                    matchScore[scoreIdx] = null;
                } else {
                    switch (score) {
                        case 'L':
                            matchScore[0] = score;
                            break;
                        case 'E':
                            matchScore[1] = score;
                            break;
                        case 'V':
                            matchScore[2] = score;
                            break;
                    }
                }
                gState.quinielaPrincipal.precio = calculateTotalPrice(unitPrice, currentScore);
                document.getElementById('totalPrice').innerText = gState.total();
            }

            function calculateTotalPrice(price, score) {
                if (score.flat().filter(e => e !== null).length == 0) {
                    return 0;
                }
                var counterArray = [];
                var i = 0, total = price;
                for (i = 0; i < score.length; i++) {
                    var t = score[i].filter(e => e !== null).length;
                    if (t > 0) {
                        counterArray.push(t);
                    }
                }
                var countTriples = counterArray.filter(e => e === 3).length;
                var countDoubles = counterArray.filter(e => e === 2).length;
                for (i = 1; i <= countTriples; i++) {
                    total *= 3;
                }
                for (i = 1; i <= countDoubles; i++) {
                    total *= 2;
                }

                return total;
            }

            function drawScore(elementId, data, name) {
                clearElement(elementId);
                var container = document.getElementById(elementId);
                if (!container) {
                    return;
                }
                container.innerHTML += `<span class="mx-3">${data.join('&emsp;')} &emsp; &emsp; ${name}</span>`;
            }

            function drawPools(elementId, key, dataset) {
                clearElement(elementId);
                var parentContainer = document.getElementById(elementId);
                dataset.forEach((e, idx) => {
                    var div = document.createElement('div');
                    div.id = 'pool_' + idx;
                    div.className = 'col-lg-7 col-md-12 text-center alert alert-success alert-dismissible';
                    div.dataset.name = e['name'];
                    parentContainer.appendChild(div);
                    drawScore(div.id, e[key], e['name']);
                    var button = document.createElement('button');
                    button.className = 'btn-close';
                    button.dataset.idx = idx;
                    button.addEventListener('click', deletePool);
                    div.appendChild(button);
                });
            }
            document.oncontextmenu = function () { return false; }
        </script>

    </main>
    </div>
    <script src="/js/prueba.js"></script>

</body>

</html>